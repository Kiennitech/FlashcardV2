<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Flashcard TOEIC - L·∫∑p l·∫°i ng·∫Øt qu√£ng</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        html, body { height: 100%; overflow-x: hidden; }
        body { font-family: 'Inter', sans-serif; background-color: #f1f5f9; padding-top: 1rem; padding-bottom: 1rem; }
        body.modal-open { overflow: hidden; }
        button, .animated-button, .srs-icon-btn, .card-nav-btn { -webkit-tap-highlight-color: transparent; }
        .flashcard-container { perspective: 1200px; }
        .flashcard { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; transition: transform 0.7s cubic-bezier(0.4, 0.0, 0.2, 1); cursor: pointer; }
        .flashcard.is-flipped { transform: rotateY(-180deg); }
        .flashcard-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; -webkit-backface-visibility: hidden; display: flex; flex-direction: column; justify-content: center; align-items: center; border-radius: 1.5rem; box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.07), 0 4px 6px -4px rgb(0 0 0 / 0.1); padding: 1.5rem; border: 1px solid rgba(0,0,0,0.05); }
        .flashcard-front { background-color: white; color: #111827; }
        .flashcard-back { background-color: #f8fafc; color: #0f172a; transform: rotateY(-180deg); overflow-y: auto; justify-content: flex-start; }
        .animated-button { transition: all 0.2s cubic-bezier(0.4, 0.0, 0.2, 1); box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1); }
        .animated-button:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1); }
        .animated-button:active { transform: translateY(0px) scale(0.98); box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1); }
        .animated-button:focus-visible { outline: none; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.4); }
        .play-audio-btn { background: none; border: none; padding: 6px; cursor: pointer; transition: all 0.2s; display: inline-flex; vertical-align: middle; color: #0f172a; }
        .play-audio-btn:hover { transform: scale(1.1); color: #0ea5e9; }
        .play-audio-btn.playing, .play-audio-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .play-audio-btn.playing svg { color: #0ea5e9; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .loader { border: 2px solid #f3f3f3; border-top: 2px solid #3498db; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; display: inline-block; }
        .modal.hidden { display: none; }
        .progress-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(16px, 1fr)); gap: 4px; }
        .progress-dot { cursor: pointer; transition: transform 0.1s ease-in-out; }
        .progress-dot:hover { transform: scale(1.5); }
        #toast-notification { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background-color: #2d3748; color: white; padding: 12px 24px; border-radius: 8px; z-index: 100; opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s, transform 0.3s; }
        #toast-notification.show { opacity: 1; visibility: visible; transform: translate(-50%, -10px); }
        .card-nav-btn { position: absolute; bottom: 1rem; width: 4.5rem; height: 4.5rem; background-color: transparent; color: #d1d5db; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: color 0.2s ease-in-out; pointer-events: auto; border-radius: 50%; }
        .card-nav-btn svg { width: 20px; height: 20px; }
        .card-nav-btn:hover { color: #9ca3af; }
        .card-nav-btn.hidden { opacity: 0 !important; pointer-events: none !important; }
        #card-counter.visible { opacity: 1; }
        .srs-icon-btn { background: none; border: none; cursor: pointer; padding: 0.5rem; border-radius: 0.5rem; transition: background-color 0.2s, transform 0.1s; display: flex; flex-direction: column; align-items: center; gap: 0.25rem; flex: 1; }
        .srs-icon-btn:hover { background-color: #f1f5f9; }
        .srs-icon-btn:focus-visible { outline: none; box-shadow: none; }
        .srs-icon-btn:active { transform: scale(0.95); }
    </style>
</head>
<body class="flex flex-col items-center">

    <div class="w-full max-w-3xl mx-auto flex flex-col flex-grow">
        <main class="flex-grow">
            <div class="flashcard-container w-full h-[36rem] md:h-[45rem] mb-6 relative mt-4">
                <div id="flashcard" class="flashcard">
                    <div class="flashcard-face flashcard-front">
                        <div id="card-front-content" class="text-center p-4">
                            <p class="text-xl text-slate-500">ƒêang t·∫£i d·ªØ li·ªáu t·ª´ v·ª±ng...</p>
                        </div>
                    </div>
                    <div class="flashcard-face flashcard-back">
                        <div id="card-back-content" class="text-left w-full h-full"></div>
                    </div>
                </div>
                <div id="card-counter" class="absolute bottom-4 left-1/2 -translate-x-1/2 bg-black bg-opacity-50 text-white text-sm font-semibold px-3 py-1 rounded-full opacity-0 transition-opacity duration-300 pointer-events-none">0 / 0</div>
                <button id="card-prev-btn" class="card-nav-btn left-2 hidden">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/></svg>
                </button>
                <button id="card-next-btn" class="card-nav-btn right-2 hidden">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/></svg>
                </button>
            </div>
            
            <div id="srs-controls" class="flex flex-col items-center justify-center w-full my-8 space-y-4">
                <div id="srs-rating-group" class="w-full items-center justify-around space-x-2 flex bg-white p-2 rounded-2xl shadow-sm invisible opacity-0 transition-opacity duration-300 ease-in-out">
                   <button data-rating="hard" class="srs-icon-btn srs-rating-btn">
                       <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M16 16s-1.5-2-4-2-4 2-4 2"></path><line x1="9" y1="9" x2="9.01" y2="9"></line><line x1="15" y1="9" x2="15.01" y2="9"></line></svg>
                       <span class="text-sm font-medium text-red-500">Kh√≥</span>
                   </button>
                   <button data-rating="good" class="srs-icon-btn srs-rating-btn">
                       <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#3b82f6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="8" y1="15" x2="16" y2="15"></line><line x1="9" y1="9" x2="9.01" y2="9"></line><line x1="15" y1="9" x2="15.01" y2="9"></line></svg>
                       <span class="text-sm font-medium text-blue-500">Trung b√¨nh</span>
                   </button>
                   <button data-rating="easy" class="srs-icon-btn srs-rating-btn">
                       <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#22c55e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M8 14s1.5 2 4 2 4-2 4-2"></path><line x1="9" y1="9" x2="9.01" y2="9"></line><line x1="15" y1="9" x2="15.01" y2="9"></line></svg>
                       <span class="text-sm font-medium text-green-600">D·ªÖ</span>
                   </button>
                   <button id="known-btn" class="srs-icon-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#8b5cf6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 19 22 12 13 5 13 19"></polygon><polygon points="2 19 11 12 2 5 2 19"></polygon></svg>
                       <span class="text-sm font-medium text-purple-500 text-center">ƒê√£ bi·∫øt</span>
                   </button>
                </div>

                <div id="action-buttons-group" class="flex items-center justify-center gap-3">
                    <button id="back-to-learn-btn" class="hidden animated-button p-4 bg-white text-slate-600 rounded-xl" title="Quay l·∫°i h·ªçc">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
                    </button>
                    <button id="shuffle-btn" class="hidden animated-button p-4 bg-white text-slate-600 rounded-xl" title="X√°o tr·ªôn danh s√°ch t·ª´">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="16 3 21 3 21 8"></polyline><line x1="4" y1="20" x2="21" y2="3"></line><polyline points="21 16 21 21 16 21"></polyline><line x1="15" y1="15" x2="21" y2="21"></line><line x1="4" y1="4" x2="9" y2="9"></line></svg>
                    </button>
                     <button id="topic-progress-btn" class="hidden animated-button p-4 bg-white text-slate-600 rounded-xl" title="Th·ªëng k√™ theo ch·ªß ƒë·ªÅ">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-pie-chart"><path d="M21.21 15.89A10 10 0 1 1 8 2.83"/><path d="M22 12A10 10 0 0 0 12 2v10z"/></svg>
                    </button>
                    <button id="progress-matrix-btn" class="animated-button p-4 bg-white text-slate-600 rounded-xl" title="Th·ªëng k√™ t·ªïng qu√°t">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg>
                    </button>
                </div>
            </div>
        </main>
        
        <footer class="w-full pt-4 pb-4">
            <div class="w-full max-w-xl mx-auto flex flex-col gap-3">
                <!-- Row for review buttons -->
                <div class="flex items-center gap-3">
                    <button id="topic-review-btn" class="hidden animated-button flex-1 px-4 py-2 bg-cyan-500 hover:bg-cyan-600 text-white font-semibold rounded-lg flex flex-col items-center justify-center disabled:bg-slate-300 disabled:transform-none disabled:shadow-none text-sm" title="√în t·∫≠p c√°c t·ª´ ƒë√£ h·ªçc trong ch·ªß ƒë·ªÅ n√†y">
                        <div class="flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
                            <span>√în t·∫≠p theo ch·ªß ƒë·ªÅ</span>
                        </div>
                        <span class="text-xs font-normal opacity-80">(<span class="font-bold">0</span>)</span>
                    </button>
                    <button id="srs-review-btn" class="animated-button flex-1 px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white font-semibold rounded-lg flex flex-col items-center justify-center disabled:bg-slate-300 disabled:transform-none disabled:shadow-none text-sm" title="√în t·∫≠p c√°c t·ª´ ƒë√£ h·ªçc theo ph∆∞∆°ng ph√°p l·∫∑p l·∫°i ng·∫Øt qu√£ng">
                        <div class="flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>
                            <span>Luy·ªán t·∫≠p ng√†y</span>
                        </div>
                        <span class="text-xs font-normal opacity-80">(<span class="font-bold">0</span>)</span>
                    </button>
                </div>
                <!-- Row for category select -->
                <div class="relative w-full">
                    <select id="category-select" class="w-full p-2.5 text-sm font-medium text-slate-700 bg-white border border-slate-300 rounded-lg shadow-sm appearance-none focus:outline-none focus:ring-2 focus:ring-blue-500 cursor-pointer" title="Ch·ªçn ch·ªß ƒë·ªÅ ƒë·ªÉ h·ªçc">
                    </select>
                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-slate-700">
                        <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                    </div>
                </div>
            </div>
        </footer>
    </div>
    
    <!-- C√°c modal kh√¥ng thay ƒë·ªïi -->
    <div id="error-modal" class="modal hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">...</div>
    <div id="progress-matrix-modal" class="modal hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50">...</div>
    <div id="confirm-modal" class="modal hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">...</div>
    <div id="toast-notification"></div>

    <script>
        // --- CONSTANTS AND STATE VARIABLES ---
        const SRS_PROGRESS_KEY = "toeicSrsProgressData";
        const LAST_SESSION_KEY = "toeicLastSession";
        
        const MODES = { LEARN: 'learn', TOPIC_REVIEW: 'topic_review', GLOBAL_REVIEW: 'global_review' };
        let currentMode = MODES.LEARN;

        // THAY ƒê·ªîI 1: C·∫•u tr√∫c d·ªØ li·ªáu m·ªõi
        let vocabularyList = []; // Danh s√°ch ph·∫≥ng c√°c t·ª´
        let vocabularyMap = new Map(); // Map ƒë·ªÉ tra c·ª©u t·ª´ nhanh
        let categories = {}; // ƒê·ªëi t∆∞·ª£ng ch·ª©a c√°c t·ª´ theo ch·ªß ƒë·ªÅ

        let srsProgressData = {};
        const SRS_INTERVALS = { 1: 1, 2: 3, 3: 7, 4: 14, 5: 30, 6: 90 };
        const MAX_SRS_LEVEL = Object.keys(SRS_INTERVALS).length;

        let currentCategoryKey = '';
        let currentWords = [];
        let currentIndex = 0;
        
        let speechSynth = window.speechSynthesis;
        let availableVoices = [];
        let voicesLoaded = false;
        let counterTimeout = null;
        let lastProgressViewCategory = null; 
        let userHasInteracted = false;

        // --- UI ELEMENT REFERENCES (Kh√¥ng thay ƒë·ªïi) ---
        const ui = { /* ... */ };
        
        const speakerIconSVG = `<svg ... </svg>`;
        const loadingIconSVG = `<div class="loader"></div>`;

        // --- CORE FUNCTIONS ---
        
        // THAY ƒê·ªîI 2: H√†m t√¨m t·ª´ m·ªõi, tra c·ª©u tr√™n Map
        function findWordData(wordKey) {
            return vocabularyMap.get(wordKey);
        }

        // --- SRS LOGIC (Kh√¥ng thay ƒë·ªïi) ---
        function updateSrsProgress(wordKey, rating) { /* ... */ }
        function markAsKnown(wordKey) { /* ... */ }
        function getGlobalReviewQueue() { /* ... */ }

        // THAY ƒê·ªîI 3: H√†m l·∫•y danh s√°ch √¥n t·∫≠p theo ch·ªß ƒë·ªÅ m·ªõi
        function getTopicReviewQueue(categoryKey) {
            if (!categories[categoryKey]) return [];
            const topicWords = categories[categoryKey];
            return topicWords.filter(wordKey => srsProgressData.hasOwnProperty(wordKey) && srsProgressData[wordKey].level < 99);
        }

        // --- DATA PERSISTENCE (Kh√¥ng thay ƒë·ªïi) ---
        function saveSrsProgress() { /* ... */ }
        function loadSrsProgress() { /* ... */ }
        function saveLastSession() { /* ... */ }
        function loadLastSession() { /* ... */ }
        function clearLastSession() { /* ... */ }
        
        // --- UI RENDERING AND UPDATES ---

        function updateControlVisibility() { /* ... */ }
        function updateReviewButtons() { /* ... */ }

        // THAY ƒê·ªîI 4: H√†m t·∫°o dropdown m·ªõi
        function createCategoryDropdown() {
            ui.categorySelect.innerHTML = '';
            let sortedKeys = Object.keys(categories).sort();

            sortedKeys.forEach((key) => {
                const count = categories[key].length;
                const option = document.createElement('option');
                option.value = key;
                option.textContent = `${key} (${count})`;
                ui.categorySelect.appendChild(option);
            });
        }

        // THAY ƒê·ªîI 5: H√†m b·∫Øt ƒë·∫ßu phi√™n h·ªçc m·ªõi
        function startSession(mode, categoryKey, customWordList = null) {
            currentMode = mode;
            currentCategoryKey = categoryKey;
            
            if (mode === MODES.LEARN) {
                const allWordsInCategory = categories[categoryKey] || [];
                // L·∫•y danh s√°ch c√°c t·ª´ ch∆∞a h·ªçc trong ch·ªß ƒë·ªÅ n√†y
                currentWords = allWordsInCategory.filter(word => !srsProgressData.hasOwnProperty(word));
                currentIndex = 0;
            } else { 
                currentWords = customWordList || [];
                currentIndex = 0;
            }
            
            if (ui.categorySelect.value !== categoryKey) {
                ui.categorySelect.value = categoryKey; 
            }
            
            updateControlVisibility();
            displayCard();
        }

        function displayCard() {
            if (ui.flashcard.classList.contains('is-flipped')) {
                ui.flashcard.classList.remove('is-flipped');
            }
            
            setTimeout(() => { 
                if (currentWords.length === 0 || currentIndex >= currentWords.length) {
                    // ... (Logic khi h·∫øt t·ª´ kh√¥ng thay ƒë·ªïi nhi·ªÅu)
                    return;
                }

                ui.srsRatingGroup.classList.remove('invisible', 'opacity-0');
                ui.cardBackContent.innerHTML = '';

                const wordKey = currentWords[currentIndex];
                const cardData = findWordData(wordKey);
                
                if (!cardData) { /* ... */ return; }

                const partsOfSpeech = [...new Set(cardData.meanings.map(m => m.type))].join(', ');
                const phoneticText = cardData.phonetic ? `/${cardData.phonetic.replace(/\//g, '')}/` : '';
                
                ui.flashcardFront.innerHTML = `...`; // (Kh√¥ng thay ƒë·ªïi)
                
                // ... (Code t·∫°o m·∫∑t tr∆∞·ªõc kh√¥ng thay ƒë·ªïi)

                // THAY ƒê·ªîI 6: Th√™m hi·ªÉn th·ªã "explanation" ·ªü m·∫∑t sau
                cardData.meanings.forEach((meaningData) => {
                    const meaningBlock = document.createElement('div');
                    meaningBlock.className = 'mb-5 p-4 bg-white rounded-xl border';

                    // ... (Code t·∫°o header c·ªßa nghƒ©a kh√¥ng thay ƒë·ªïi)
                    
                    // Th√™m ph·∫ßn gi·∫£i th√≠ch n·∫øu c√≥
                    if (meaningData.explanation) {
                        const explanationDiv = document.createElement('div');
                        explanationDiv.className = 'mt-2 mb-3 p-3 bg-gray-50 rounded-lg';
                        const explanationText = document.createElement('p');
                        explanationText.className = 'text-base text-slate-600 italic';
                        explanationText.textContent = `üí° ${meaningData.explanation}`;
                        explanationDiv.appendChild(explanationText);
                        meaningBlock.appendChild(explanationDiv);
                    }

                    const exampleList = document.createElement('ul');
                    // ... (Code t·∫°o danh s√°ch v√≠ d·ª• kh√¥ng thay ƒë·ªïi)

                    meaningBlock.append(exampleList);
                    backContentWrapper.appendChild(meaningBlock);
                });

                ui.cardBackContent.appendChild(backContentWrapper);
                updateNavigation();
                updateControlVisibility();
                
                if (userHasInteracted) {
                    playAudio(wordKey, null);
                }
            }, 150);
        }

        function showCardCounter() { /* ... */ }
        function updateNavigation() { /* ... */ }

        // THAY ƒê·ªîI 7: C·∫≠p nh·∫≠t h√†m th·ªëng k√™
        function updateProgressMatrixAndStats(categoryKey = null) {
            ui.progressGridContainer.innerHTML = '';
            
            let wordsToShow = [];
            let title = "Th·ªëng k√™ t·ªïng qu√°t";

            if (categoryKey && categories[categoryKey]) {
                title = `Th·ªëng k√™ ch·ªß ƒë·ªÅ: ${categoryKey}`;
                wordsToShow = categories[categoryKey];
            } else {
                wordsToShow = Array.from(vocabularyMap.keys());
            }
            
            // ... (Ph·∫ßn c√≤n l·∫°i c·ªßa h√†m kh√¥ng thay ƒë·ªïi nhi·ªÅu, ch·ªâ c·∫ßn d√πng `wordsToShow` l√† m·∫£ng c√°c key)
        }
        
        function playAudio(text, buttonEl) { /* ... */ }

        // --- EVENT HANDLERS (Kh√¥ng thay ƒë·ªïi) ---
        function handleSrsAnswer(rating) { /* ... */ }
        function handleKnownAnswer() { /* ... */ }
        function navigate(direction) { /* ... */ }
        function shuffleCurrentQueue() { /* ... */ }
        function resetAllProgress() { /* ... */ }
        function showToast(message) { /* ... */ }
        function showErrorModal(message, title = "ƒê√£ x·∫£y ra l·ªói") { /* ... */ }
        function showConfirmModal(title, message, onConfirm) { /* ... */ }
        function lockBodyScroll() { /* ... */ }
        function unlockBodyScroll() { /* ... */ }
        
        // THAY ƒê·ªîI 8: C·∫≠p nh·∫≠t h√†m t·∫£i d·ªØ li·ªáu
        async function loadVocabularyData(url) {
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`L·ªói HTTP! Tr·∫°ng th√°i: ${response.status}`);
                }
                const data = await response.json();
                
                // X·ª≠ l√Ω d·ªØ li·ªáu ph·∫≥ng th√†nh c√°c c·∫•u tr√∫c c·∫ßn thi·∫øt
                if (Array.isArray(data)) {
                    vocabularyList = data;
                    vocabularyList.forEach(wordData => {
                        // Th√™m v√†o Map ƒë·ªÉ tra c·ª©u
                        vocabularyMap.set(wordData.word, wordData);
                        
                        // Ph√¢n lo·∫°i v√†o c√°c ch·ªß ƒë·ªÅ
                        const category = wordData.category;
                        if (!categories[category]) {
                            categories[category] = [];
                        }
                        categories[category].push(wordData.word);
                    });
                    return true;
                } else {
                    throw new Error("ƒê·ªãnh d·∫°ng JSON kh√¥ng ph·∫£i l√† m·ªôt m·∫£ng (Array).");
                }

            } catch (error) {
                console.error('Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu t·ª´ v·ª±ng:', error);
                // ... (Hi·ªÉn th·ªã l·ªói)
                return null;
            }
        }

        // --- INITIALIZATION ---
        function initializeApp() {
            loadSrsProgress();
            
            const firstCategory = Object.keys(categories)[0] || null;
            currentCategoryKey = firstCategory;

            createCategoryDropdown();
            
            // --- Event Listeners (Kh√¥ng thay ƒë·ªïi) ---
            
            if (firstCategory) {
                startSession(MODES.LEARN, firstCategory);
            } else {
                 ui.flashcardFront.innerHTML = `<p class="text-xl text-slate-500">Kh√¥ng c√≥ d·ªØ li·ªáu t·ª´ v·ª±ng n√†o.</p>`;
                 updateControlVisibility();
            }
        }
        
        async function startApp() {
            const dataUrl = 'vocabulary.json';
            const success = await loadVocabularyData(dataUrl);

            if (success) {
                try {
                    initializeApp();
                } catch (error) {
                    console.error('Kh√¥ng th·ªÉ kh·ªüi t·∫°o ·ª©ng d·ª•ng v·ªõi d·ªØ li·ªáu:', error);
                    showErrorModal(`${error.message}.`, "L·ªói kh·ªüi t·∫°o d·ªØ li·ªáu");
                }
            }
        }
        
        function loadVoices() { /* ... */ }
        function handleFirstInteraction() { /* ... */ }

        // --- APP START (Kh√¥ng thay ƒë·ªïi) ---
        document.addEventListener('DOMContentLoaded', () => { /* ... */ });
    </script>
</body>
</html>
